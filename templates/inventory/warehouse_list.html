<!-- /inventory/warehouse_list.html -->

{% extends 'inventory/base.html' %}
{% block title %}倉庫列表{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>倉庫列表</h2>
    <a href="{% url 'inventory:warehouse_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> 新增倉庫
    </a>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for warehouse in warehouses %}
    <div class="col">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">
                    <a href="{% url 'inventory:warehouse_detail' warehouse.pk %}" class="text-decoration-none">
                        {{ warehouse.name }}
                    </a>
                </h5>
                <p class="card-text">
                    <strong>代碼：</strong>{{ warehouse.code }}<br>
                    <strong>位置：</strong>{{ warehouse.location }}<br>
                    <strong>類型：</strong>{{ warehouse.get_warehouse_type_display }}<br>
                    <strong>負責人：</strong>{{ warehouse.manager.get_full_name|default:'未指定' }}
                </p>
            </div>
            <div class="card-footer bg-transparent">
                <!-- 使用 JavaScript 處理進度條 -->
                <div class="progress" style="height: 20px;">
                    <div class="progress-bar progress-bar-{{ forloop.counter }}" 
                         role="progressbar"
                         data-percentage="{{ warehouse.capacity_percentage|default:0|floatformat:2 }}"
                         aria-valuemin="0" 
                         aria-valuemax="100"
                         style="font-size: 12px; line-height: 20px;">
                        計算中...
                    </div>
                </div>
                <small class="text-muted mt-1 d-block">
                    已用 {{ warehouse.used_capacity|floatformat:2 }} / {{ warehouse.total_capacity|floatformat:2 }} m³
                </small>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info text-center">尚未建立任何倉庫</div>
    </div>
    {% endfor %}
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 處理所有進度條
    document.querySelectorAll('.progress-bar').forEach(function(progressBar) {
        const percentage = parseFloat(progressBar.getAttribute('data-percentage')) || 0;
        
        // 設置寬度
        progressBar.style.width = percentage + '%';
        progressBar.setAttribute('aria-valuenow', percentage);
        progressBar.textContent = percentage.toFixed(1) + '%';
        
        // 設置顏色類別
        if (percentage > 80) {
            progressBar.classList.add('bg-danger');
        } else if (percentage > 60) {
            progressBar.classList.add('bg-warning');
        } else {
            progressBar.classList.add('bg-success');
        }
    });
});
</script>

<style>
    /* 進度條基本樣式 */
    .progress-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px; /* 確保文字可見 */
        transition: width 0.3s ease-in-out;
        overflow: visible;
        white-space: nowrap;
    }
    
    /* 進度條容器 */
    .progress {
        background-color: #e9ecef;
        border-radius: 0.375rem;
        overflow: hidden;
        position: relative;
    }
    
    /* 卡片懸停效果 */
    .card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* 鏈接樣式 */
    .card-title a {
        color: #0d6efd;
        text-decoration: none;
    }
    
    .card-title a:hover {
        color: #0a58ca;
        text-decoration: underline;
    }
    
    /* 卡片文字樣式 */
    .card-text {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    
    .card-text strong {
        color: #495057;
        font-weight: 600;
    }
    
    /* 卡片底部樣式 */
    .card-footer {
        border-top: 1px solid rgba(0,0,0,0.125);
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }
</style>
{% endblock %}