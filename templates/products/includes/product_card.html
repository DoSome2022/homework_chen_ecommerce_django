<div class="card product-card h-100">
    {% if product.discount_percentage > 0 %}
    <div class="position-absolute top-0 start-0 m-2">
        <span class="badge badge-sale">-{{ product.discount_percentage|floatformat:0 }}%</span>
    </div>
    {% endif %}
    
    {% if product.is_new %}
    <div class="position-absolute top-0 end-0 m-2">
        <span class="badge badge-new">新品</span>
    </div>
    {% endif %}

    <a href="{{ product.get_absolute_url }}">
        {% with product.get_main_image as main_image %}
        {% if main_image %}
        <img src="{{ main_image.image.url }}" class="card-img-top product-image" alt="{{ main_image.alt_text }}">
        {% else %}
        <img src="/static/images/no-image.jpg" class="card-img-top product-image" alt="暂无图片">
        {% endif %}
        {% endwith %}
    </a>

    <div class="card-body d-flex flex-column">
        <h5 class="card-title">
            <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                {{ product.name }}
            </a>
        </h5>
        
        <p class="card-text text-muted small">{{ product.short_description|truncatechars:60 }}</p>
        
        <div class="mt-auto">
            <!-- 价格 -->
            <div class="mb-2">
                <span class="fs-4 fw-bold text-primary">¥{{ product.price }}</span>
                {% if product.compare_at_price %}
                <span class="price-old ms-2">¥{{ product.compare_at_price }}</span>
                {% endif %}
            </div>
            
            <!-- 库存状态 -->
            <div class="mb-2">
                {% with product.check_availability as availability %}
                {% if availability.available %}
                <span class="badge bg-success">{{ availability.message }}</span>
                {% else %}
                <span class="badge bg-danger">{{ availability.message }}</span>
                {% endif %}
                {% endwith %}
            </div>
            
            <!-- 评价 -->
            {% if product.rating > 0 %}
            <div class="mb-2">
                <span class="rating-stars">
                    {% for i in "12345" %}
                    {% if forloop.counter <= product.rating %}
                    <i class="fas fa-star"></i>
                    {% else %}
                    <i class="far fa-star"></i>
                    {% endif %}
                    {% endfor %}
                </span>
                <small class="text-muted">({{ product.review_count }})</small>
            </div>
            {% endif %}
        </div>
    </div>
</div>